<html>
<head>
  <meta charset="utf-8">
  <title>Mocha Tests</title>
  <link rel="stylesheet" href="mocha.css" />
  <script src="expect.js"></script>
  <script src="mocha.js"></script>
  <script src="http://localhost:8080/socket.io/socket.io.js"></script>
  
  <script type="text/javascript">
    curl = {
           baseUrl: 'http://localhost:8080/',
           packages: {
             'jquery': {
               path:'http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/',
               main:'jquery.min'
             },
             'underscore':{
               path:'https://raw.github.com/amdjs/underscore/master/',
               main:'underscore-min'
             },
             'ginger': {
               path: 'http://localhost:8080/',
               main: 'ginger',
               lib: ''
             },
             'gnd': {
                path: 'http://localhost:8080/',
                main: 'gnd.ts?',
                lib: ''
            },
             'util': {
                path: 'http://localhost:8080/lib',
                main: 'util.ts?',
                lib: ''
            },
            'route': {
               path: 'http://localhost:8080/lib',
               main: 'route.ts?',
               lib: ''
             },
             'task': {
               path: 'http://localhost:8080/lib',
               main: 'task.ts?',
               lib: ''
             },
             'event': {
               path: 'http://localhost:8080/lib',
               main: 'event.ts?',
               lib: ''
             },
             'base': {
               path: 'http://localhost:8080/lib',
               main: 'base.ts?',
               lib: ''
             },
             'undo': {
               path: 'http://localhost:8080/lib',
               main: 'undo.ts?',
               lib: ''
             },
             'cache': {
               path: 'http://localhost:8080/lib',
               main: 'cache.ts?',
               lib: ''
             },
             'overload': {
               path: 'http://localhost:8080/lib',
               main: 'overload.ts?',
               lib: ''
             },
             'storage': {
               path: 'http://localhost:8080/lib',
               main: 'storage.ts?',
               lib: ''
             },
             'local': {
               path: 'http://localhost:8080/lib/storage',
               main: 'local.ts?',
               lib: ''
             },
             'socket': {
               path: 'lib/storage',
               main: 'socket.ts?',
               lib: ''
             },
             'storage/socket': {
               path: 'lib/storage',
               main: 'qwesocketqwe.ts?',
               lib: ''
             },
             'model': {
               path: 'http://localhost:8080/lib',
               main: 'model.ts?',
               lib: ''
             },
             'collection': {
               path: 'http://localhost:8080/lib',
               main: 'collection.ts?',
               lib: ''
             },
             'sync': {
               path: 'http://localhost:8080/lib/sync',
               main: 'sync.ts?',
               lib: ''
             }
           }
       };
  </script>
  
  <script src="http://localhost:8080/curl.js"></script>
  
  <script>
    mocha.setup('bdd')
  
    var socket = io.connect('http://localhost:8080');
    socket.once('connect', function(){
      socket.on('file_changed:', function(url){
        document.location.reload(true)
      })
      curl(['underscore'], function(_){  
        curl(['test/test_cache'], function(){
          curl(['test/test_util',
                'test/test_storage_local',
                'test/test_storage_socket',
                'test/test_overload',
                'test/test_models',
                'test/test_collections',
                'test/test_tasks',
                'test/test_events',
                'test/test_viewmodel',
                // 'test/test_base',
                'test/test_routes',             
                 //'test/test_declare',
                ], function(Storage){
                  // We need to run this first.
            /*

            */
            mocha
                .run()
                .globals(['socket']) // acceptable globals
          });
        });
      });
    });
  </script>
</head>
<body>
  <div id="mocha"></div>
</body>
</html>
