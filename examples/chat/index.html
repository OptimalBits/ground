<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chat Example</title>
  <!--<link rel="stylesheet" type="text/css" href="styles.css"> -->
  <script src="http://localhost:8080/socket.io/socket.io.js"></script>
  <script type="text/javascript">
    curl = {
      baseUrl: 'http://localhost:8080/routing/',
      packages: {
        'ginger': {
          path: 'http://localhost:8080/',
          main: 'ginger',
          lib: ''
        },
        'jquery': {
          path: 'http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/',
          main: 'jquery.min'
        },
        'jqueryui': {
          path: 'http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/',
          main: 'jquery-ui.min'
        },
        'underscore':{
          path:'https://raw.github.com/amdjs/underscore/master/',
          main:'underscore-min'
        },
      }
    };
  </script>
  
  <script src="https://raw.github.com/cujojs/curl/master/dist/curl-kitchen-sink/curl.js"></script>
  <script>

    curl(['ginger'], function(ginger){
      var socket = io.connect('http://localhost:8080');
      socket.on('connect', function(){
        
        ginger.Model.set('socket', socket);

//        var Message = ginger.Declare(ginger.Model);
//        Message.bucket('messages');
//        Message.use('socket');

        var Chat = ginger.Declare(ginger.Model);
        Chat.bucket('Chat');

        $('#submit').click(function() {
          chat = new Chat();
          chat.keepSynced();
          
          chat.save(function(err){
            var url = 'http://localhost:8080/chat/room.html#/' + chat._id;

            console.log(err);

            $('#link').append('<li><a href="' + url + '" target="_blank">' + url + '</a></li>');
          });
        });
      }); 
    });
  </script>
</head>
<body>
  <input id="submit" type="submit" value="Create new Room"></input>
  <ul id="link"></ul>
</body>
</html>
