<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chat Example</title>
  <link rel="stylesheet" type="text/css" href="../styles.css">
  <script src="../socket.io/socket.io.js"></script>
  <script type="text/javascript">
    curl = {
           baseUrl: '',
           paths: {
              'jquery': 'http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min',
              'underscore': 'https://raw.github.com/amdjs/underscore/master/underscore-min',
              'jqueryui': 'http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min'
           },
           packages: {
             'ginger': {
                 path: '', // http://localhost:8080 (relative)
                 main: 'ginger',
                 lib: ''
             }
           }
       };
  </script>
  
  <script src="https://raw.github.com/cujojs/curl/master/dist/curl-kitchen-sink/curl.js"></script>
  <script>

    curl(['ginger'], function(ginger){
      var socket = io.connect(location.protocol+'//'+location.host);
      socket.on('connect', function(){
        
        ginger.Model.set('socket', socket);

        var Chat = ginger.Declare(ginger.Model);
        Chat.bucket('Chat');

        $('#submit').click(function() {
          chat = new Chat();
          chat.keepSynced();
          
          chat.save(function(err){
            // create an URL pointing at the new room
            var url = location.href.replace(/[^\/]*$/, '') +
              'room.html#' + chat._id;

            // show the link to the new chat room on the page
            $('#link').append('<li><a href="' + url + '" target="_blank">' + url + '</a></li>');
          });
        });
      }); 
    });
  </script>
</head>
<body>
  <h1>Chat example</h1>
  <p>This example demonstrates how Ground models can be used to create chat roooms on the fly.</p>
  <input id="submit" type="submit" value="Create new Room"></input>
  <ul id="link"></ul>
</body>
</html>
